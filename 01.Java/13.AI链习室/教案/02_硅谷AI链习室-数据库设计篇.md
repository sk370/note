## 硅谷AI链习室数据库设计

[TOC]

### 一、数据库设计理论

#### 1.1 数据库模型

数据库设计中最常采用的模型为**实体（Entity）关系（Relationship）模型**，简称ER模型。其核心思想是将现实世界中的复杂数据表示为一组实体，并描述这些实体之间的关系。

- **实体**通常对应现实世界中的一个**对象**，例如：学生、题目、试卷、考试记录。

- 每个实体都包含一组**属性**，这些属性用于描述实体，例如题目实体包含标题、类型、难度等属性。
- **关系**用于描述各实体之间的联系，例如试卷和题目之间存在包含关系。

其中**关系**可分为**一对一**、**一对多**、**多对多**三种，例如分类和题目之间的关系为**一对多**、试卷和题目之间的关系为**多对多**。

实体关系模型通常使用实体关系图（ER diagram）进行表示。下图是一个简易的考试系统的实体关系图，其中方框代表实体，方框之间的连线则代表实体间的关系，连线两端的不同符号用于表示一对一、一对多、多对多的关系。

<img src="images/ER图示例.drawio.svg" alt="ER图示例.drawio" style="zoom:85%;" />

符号说明如下：

|                符号                |   说明   |
| :--------------------------------: | :------: |
|  ![](images/ER符号-零.drawio.svg)  | 表示0个  |
| ![](images/ER图符号-一.drawio.svg) | 表示1个  |
| ![](images/ER图符号-多.drawio.svg) | 表示多个 |

上述符号通常是两个**成对**使用，其分别表示**最小值**和**最大值**。例如上述ER图中的**分类**和**题目**之间的连线，**分类**一侧的符号表示**一**（最小值和最大值都是一），**题目**一侧的符号表示**多**（最小值是一，最大值是多），其表达的含义就是分类和题目之间的关系为**一对多**，一个题目只对应一个分类，而一个分类会对应多个题目（且至少对应一个题目）。

#### 1.2 数据库设计流程

传统的数据库设计流程分为三个阶段，分别是**概念模型设计阶段**、**逻辑模型设计阶段**和**物理模型设计阶段**。三个阶段由粗略到详细，由抽象到具体。

##### 1.2.1 **概念模型设计**

概念模型是一个粗略的初步设计，其只关注实体和关系，不体现最终建表所需的各种细节信息（例如实体的属性）。下图便是一个典型的简易**选课系统**数据库的概念模型。

<img src="images/ER%E5%9B%BE%E7%A4%BA%E4%BE%8B.drawio.svg" style="zoom:85%;" />

##### 1.2.2 **逻辑模型设计**

相较于概念模型，逻辑模型会包含更多的细节信息，例如实体的属性、用于关联两个实体的字段等等。需要注意的是，逻辑模型并不关注具体的数据库实现（例如MySQL或者Oracle）。下图是上述选课系统数据库的逻辑模型。

<img src="images/ER%E6%A8%A1%E5%9E%8B-%E9%80%BB%E8%BE%91%E6%A8%A1%E5%9E%8B.drawio.svg" style="zoom: 50%;" />

##### 1.2.3 **物理模型设计**

相较于逻辑模型，物理模型会包含更多的与所选数据库相关的具体信息，例如存储引擎、字段类型、索引等信息。一般而言，物理模型会包含最终建表所需的所有信息，下图是上述选课系统数据库的物理模型。

<img src="images/ER%E6%A8%A1%E5%9E%8B-%E7%89%A9%E7%90%86%E6%A8%A1%E5%9E%8B.drawio.svg" style="zoom:50%;" />

### 二、硅谷AI链习室核心逻辑模型

#### 2.1 题目管理逻辑模型设计

题目管理涉及四个实体：`题目类别实体`，`题目实体`，`题目答案实体`，`题目选项实体`。

![题目管理逻辑图.drawio](assets/题目管理逻辑图.drawio.svg)

#### 2.2 试卷管理逻辑模型设计

试卷管理涉及四个实体：`题目实体`，`试卷题目关联实体`，`试卷实体`。

![试卷管理逻辑图.drawio](assets/试卷管理逻辑图.drawio-1753952549427.svg)

#### 2.3 考试管理逻辑模型设计

试卷管理涉及四个实体：`试卷实体`，`考试记录实体`，`答题记录实体`，`题目实体`。

![考试管理逻辑图.drawio](assets/考试管理逻辑图.drawio.svg)



#### 2.4 视频管理逻辑模型设计

试卷管理涉及四个实体：`视频类别实体`，`视频实体`，`视频点赞实体`，`视频观看实体`。

![视频管理逻辑图.drawio](assets/视频管理逻辑图.drawio.svg)

#### 2.5 总体逻辑模型设计

![总体逻辑图.drawio](assets/总体逻辑图.drawio.svg)

### 三、数据库表详细设计

#### 3.1 用户管理模块

##### 3.1.1 用户表 (users)

用户表用于存储系统用户的基本信息，支持管理员和学生两种角色。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 用户ID，主键 |
| username | varchar | 50 | NOT NULL | - | 用户名，唯一 |
| password | varchar | 100 | NOT NULL | - | 密码（加密后） |
| real_name | varchar | 50 | NULL | - | 真实姓名 |
| role | varchar | 20 | NOT NULL | 'STUDENT' | 角色：ADMIN/STUDENT |
| status | varchar | 20 | NOT NULL | 'ACTIVE' | 状态：ACTIVE/INACTIVE |

#### 3.2 题目管理模块

##### 3.2.1 题目分类表 (categories)

分类表用于管理题目的分类体系，支持多级分类结构。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 分类ID，主键 |
| name | varchar | 100 | NOT NULL | - | 分类名称 |
| parent_id | bigint | - | NULL | - | 父分类ID |
| sort_order | int | - | NOT NULL | 0 | 排序序号 |

##### 3.2.2 题目表 (questions)

题目表是系统的核心表，存储所有题目的基本信息。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 题目ID，主键 |
| title | text | - | NOT NULL | - | 题目内容 |
| type | varchar | 20 | NOT NULL | - | 题目类型：CHOICE/JUDGE/TEXT |
| multi | tinyint | 1 | NOT NULL | 0 | 是否多选：0-单选，1-多选 |
| category_id | bigint | - | NULL | - | 分类ID |
| difficulty | varchar | 20 | NOT NULL | 'MEDIUM' | 难度：EASY/MEDIUM/HARD |
| score | int | - | NOT NULL | 1 | 默认分值（用于试卷组成） |
| analysis | text | - | NULL | - | 题目解析 |

##### 3.2.3 题目选项表 (question_choices)

选项表用于存储选择题和判断题的选项信息。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 选项ID，主键 |
| question_id | bigint | - | NOT NULL | - | 关联题目ID |
| content | text | - | NOT NULL | - | 选项内容 |
| is_correct | tinyint | 1 | NOT NULL | 0 | 是否正确答案 |
| sort | int | - | NOT NULL | 0 | 排序序号 |

##### 3.2.4 题目答案表 (question_answers)

答案表用于存储题目的标准答案和评分关键词。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 答案ID，主键 |
| question_id | bigint | - | NOT NULL | - | 关联题目ID |
| answer | text | - | NOT NULL | - | 标准答案 |
| keywords | text | - | NULL | - | 关键词（用于AI评分） |

#### 3.3 试卷管理模块

##### 3.3.1 试卷表 (paper)

试卷表用于存储试卷的基本信息和配置。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | int | - | NOT NULL | 自增 | 试卷ID，主键 |
| name | varchar | 200 | NOT NULL | - | 试卷名称 |
| description | text | - | NULL | - | 试卷描述 |
| duration | int | - | NOT NULL | 60 | 考试时长（分钟） |
| total_score | int | - | NOT NULL | 100 | 试卷总分 |
| status | varchar | 20 | NOT NULL | 'DRAFT' | 状态：DRAFT/PUBLISHED/STOPPED |
| question_count | int | - | NOT NULL | 0 | 试卷题目数量 |

##### 3.3.2 试卷题目关联表 (paper_questions)

关联表用于建立试卷和题目的多对多关系。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 关联ID，主键 |
| paper_id | int | - | NOT NULL | - | 试卷ID |
| question_id | bigint | - | NOT NULL | - | 题目ID |
| score | int | - | NOT NULL | 1 | 题目分值 |

#### 3.4 考试管理模块

##### 3.4.1 考试记录表 (exam_records)

考试记录表用于记录学生的考试过程和结果。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | int | - | NOT NULL | 自增 | 记录ID，主键 |
| exam_id | int | - | NOT NULL | - | 试卷ID |
| student_name | varchar | 100 | NOT NULL | - | 学生姓名 |
| score | int | - | NULL | - | 得分 |
| start_time | datetime | - | NULL | - | 开始时间 |
| end_time | datetime | - | NULL | - | 结束时间 |
| status | varchar | 20 | NOT NULL | 'IN_PROGRESS' | 状态：IN_PROGRESS/COMPLETED/TIMEOUT |
| window_switches | int | - | NOT NULL | 0 | 窗口切换次数 |
| answers | varchar | 200 | NULL | - | ai评价 |

##### 3.4.2 答题记录表 (answer_record)

答题记录表用于存储学生每道题的具体答题情况。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | int | - | NOT NULL | 自增 | 记录ID，主键 |
| exam_record_id | int | - | NOT NULL | - | 考试记录ID |
| question_id | int | - | NOT NULL | - | 题目ID |
| user_answer | text | - | NULL | - | 学生答案（选择题 A A,B 判断 T F 文档直接为答案！） |
| score | int | - | NULL | - | 得分 |
| is_correct | int | - | NULL | - | 正确性：0-错误，1-正确，2-部分正确 |
| ai_correction | text | - | NULL | - | AI批改意见 |

#### 3.5 系统管理模块

##### 3.5.1 系统公告表 (notices)

公告表用于管理系统公告和通知信息。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 公告ID，主键 |
| title | varchar | 200 | NOT NULL | - | 公告标题 |
| content | text | - | NOT NULL | - | 公告内容 |
| type | varchar | 20 | NOT NULL | 'NOTICE' | 类型：SYSTEM/FEATURE/NOTICE |
| priority | int | - | NOT NULL | 0 | 优先级：0-普通，1-重要，2-紧急 |
| is_active | tinyint | 1 | NOT NULL | 1 | 是否启用 |

##### 3.5.2 轮播图表 (banners)

轮播图表用于管理首页轮播图展示。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 轮播图ID，主键 |
| title | varchar | 200 | NOT NULL | - | 标题 |
| description | text | - | NULL | - | 描述 |
| image_url | varchar | 500 | NOT NULL | - | 图片URL |
| link_url | varchar | 500 | NULL | - | 跳转链接 |
| sort_order | int | - | NOT NULL | 0 | 排序序号 |
| is_active | tinyint | 1 | NOT NULL | 1 | 是否启用 |

#### 3.6 视频学习模块

##### 3.6.1 视频表 (videos)

视频表是视频学习模块的核心表，存储所有视频的基本信息。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 视频ID，主键 |
| title | varchar | 200 | NOT NULL | - | 视频标题 |
| description | text | - | NULL | - | 视频描述 |
| category_id | bigint | - | NOT NULL | - | 分类ID |
| file_url | varchar | 500 | NOT NULL | - | 视频文件URL |
| cover_url | varchar | 500 | NULL | - | 封面图片URL |
| duration | int | - | NULL | - | 视频时长（秒） |
| file_size | bigint | - | NULL | - | 文件大小（字节） |
| uploader_name | varchar | 100 | NOT NULL | - | 上传者名称 |
| uploader_type | tinyint | - | NULL | 1 | 上传者类型：1-用户投稿，2-管理员上传 |
| user_id | bigint | - | NULL | - | 上传用户ID（用户投稿时） |
| admin_id | bigint | - | NULL | - | 管理员ID（管理员上传时） |
| status | tinyint | - | NULL | 0 | 状态：0-待审核，1-已发布，2-已拒绝，3-已下架 |
| audit_admin_id | bigint | - | NULL | - | 审核管理员ID |
| audit_time | datetime | - | NULL | - | 审核时间 |
| audit_reason | text | - | NULL | - | 审核原因（拒绝时） |
| view_count | bigint | - | NULL | 0 | 观看次数 |
| like_count | bigint | - | NULL | 0 | 点赞次数 |
| tags | varchar | 500 | NULL | - | 标签，逗号分隔 |

##### 3.6.2 视频分类表 (video_categories)

视频分类表用于管理视频的分类体系，支持多级分类结构。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 分类ID，主键 |
| name | varchar | 100 | NOT NULL | - | 分类名称 |
| description | text | - | NULL | - | 分类描述 |
| parent_id | bigint | - | NULL | 0 | 父级分类ID，0为顶级 |
| sort_order | int | - | NULL | 0 | 排序权重 |
| status | tinyint | - | NULL | 1 | 状态：1-启用，0-禁用 |

##### 3.6.3 视频观看记录表 (video_views)

视频观看记录表用于统计用户的视频观看行为。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 观看ID，主键 |
| video_id | bigint | - | NOT NULL | - | 视频ID |
| user_ip | varchar | 50 | NOT NULL | - | 用户IP |
| user_agent | varchar | 500 | NULL | - | 用户代理信息 |
| view_duration | int | - | NULL | - | 观看时长（秒） |
| created_at | datetime | - | NULL | CURRENT_TIMESTAMP | 观看时间 |

##### 3.6.4 视频点赞记录表 (video_likes)

视频点赞记录表用于记录用户对视频的点赞行为。

| 字段名 | 数据类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|----------|------|----------|--------|------|
| id | bigint | - | NOT NULL | 自增 | 点赞ID，主键 |
| video_id | bigint | - | NOT NULL | - | 视频ID |
| user_ip | varchar | 50 | NOT NULL | - | 用户IP（匿名点赞） |
| user_agent | varchar | 500 | NULL | - | 用户代理信息 |
| created_at | datetime | - | NULL | CURRENT_TIMESTAMP | 点赞时间 |
